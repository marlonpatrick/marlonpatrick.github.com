<!DOCTYPE html>
<html lang="en,pt-br,default">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Marlon Patrick">
    <title>PrimeFaces:Menu dinâmico e a inofensiva mensagem Unable to find component... - Marlon Patrick</title>
    <meta name="author" content="Marlon Patrick">
    <meta name="description" content="Marlon Patrick">
    <link rel="icon" href="/assets/images/null">
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="atom.xml">
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css" type="text/css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-29896969-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="http://marlonpatrick.info">Marlon Patrick</a>
    </h1>
    
</header>
            <nav id="sidebar" data-behavior="1">
    
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/pt-br">
            
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Início</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/pt-br/all-categories">
            
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categorias</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/pt-br/all-tags">
            
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/pt-br/all-archives">
            
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Arquivo</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link st-search-show-outputs" href="/#search">
            
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Pesquisar</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/#about">
            
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">Sobre</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://github.com/marlonpatrick10" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="http://stackoverflow.com/users/1842759/marlon-patrick" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
                    <span class="sidebar-button-desc">Stack Overflow</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://br.linkedin.com/in/marlonpatrick" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                    <span class="sidebar-button-desc">Linked In</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="http://www.shelfari.com/o1515626551/shelf" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-book"></i>
                    <span class="sidebar-button-desc">Shelfari</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/atom.xml">
            
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            <div id="main" data-behavior="1">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
        <div class="post-header main-content-wrap">
    
        <h1 class="post-title" itemprop="headline">PrimeFaces:Menu dinâmico e a inofensiva mensagem Unable to find component...</h1>
    
    <div class="post-meta">
    <time  itemprop="datePublished" content="Thu Jan 24 2013 12:00:00 GMT-0300">
        24/01/2013
    </time>
    
        <span>em </span>
        
    <a class="category-link" href="/categories/JSF/">JSF</a>, <a class="category-link" href="/categories/JSF/PrimeFaces/">PrimeFaces</a>


    
</div>

</div>
    
    <div class="post-content markdown main-content-wrap" itemprop="articleBody">
        <p>Eu sou particularmente fã incondicional do PrimeFaces e um dos componentes que mais gosto é o de gerar menus dinâmicos. Praticamente todas as aplicações tem o conceito de perfil de acesso o que acaba tornando o componente MenuBar extremamente útil para esse tipo de requisito. Basicamente, o sistema só irá renderizar os menus o qual apontam para telas que o usuário pode acessar.</p>
<a id="more"></a>
<p>Bem, estou usando esse componente exatamente no cenário descrito acima com a versão 3.4.1 do PrimeFaces e a implementação de referência do JSF(Mojarra) na sua versão 2.1.7. Com essa combinação (PrimeFaces/Mojarra) nas versões descritas acima (acredito que em outras também) percebi no log de minha aplicação que todas as vezes que executava uma chamada ajax, para cada item do menu gerado com o MenuBar dinâmico, havia uma mensagem mais ou menos assim:<strong>Unable to find component with clientId ‘menuitem200’, no need to remove it.</strong>.</p>
<p>Até um determinado momento em nada me afetava tal mensagem, e provavelmente é assim para 99% dos casos. Agora, se você assim como eu, caiu no 1% restante, essa mensagem pode causar um sério problema de performance nas chamadas ajax. Esse problema de performance só irá acontecer se você tiver uma página muito grande, com muitos componentes gerados como foi o meu caso.</p>
<p>Toda vez que eu fazia uma chamada ajax nessa página o procedimento executado pelo PrimeFaces que gerava as mensagens “Unable to find component…” chegava a levar cerca de 1 minuto e 30 segundos para terminar, o que é totalmente inviável. Não é que o código executado na chamada era super pesado, esses mais de 1 minuto se referem apenas execução do método que gerava as mensagens como mostra o log abaixo:</p>
<pre><code>02:40:00,876 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;submenu1&apos;, no need to remove it.
02:40:01,298 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;submenu2&apos;, no need to remove it.
02:40:01,656 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;menuitem45&apos;, no need to remove it.
02:40:02,014 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;menuitem4&apos;, no need to remove it.
02:40:02,361 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;submenu20&apos;, no need to remove it.

...muitas outras mensagens aqui...

02:40:44,240 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;menuitemespacobefore&apos;, no need to remove it.
02:40:44,917 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;submenuuseractions&apos;, no need to remove it.
02:40:45,249 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;menuitemchangepassword&apos;, no need to remove it.
02:40:45,574 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;menuitemlogout&apos;, no need to remove it.
</code></pre><p>No exemplo acima, o tempo total foi de 46 segundos. Basicamente o que acontece é que na fase JSF Restore View é executado o método que restaura o estado dos menus dinâmicos, onde, para cada item do menu é feito uma busca em toda a árvore de componentes do JSF e devido a página ser grande leva um tempo considerável. O pior é que, como a própria mensagem diz, “no need to remove it”, não é necessário remover tal componente da árvore JSF porque na verdade ele já foi removido.</p>
<p>No meu caso, o que percebi é que quando o item do menu dinâmico usa um link não é necessário essa remoção que o PrimeFaces tenta fazer, já quando o item do menu usa uma Action Expression, aí sim, esse procedimento é necessário.</p>
<pre><code>//Não é necessário tentar remover esse MenuItem, pois, ele usa um link
MenuItem changePassword = new MenuItem();
changePassword.setId(&quot;menuitemchangepassword&quot;);
changePassword.setValue(&quot;Mudar Senha&quot;);
changePassword.setUrl(&quot;/user/changePassword.xhtml?faces-redirect=true&quot;);
submenuUser.getChildren().add(changePassword);

//De fato é preciso remover o menu item para adicionar o novo objeto na fase de Restore View, pois, ele usa uma Action Expression
MethodExpression logoutAction = factory.createMethodExpression(context.getELContext(), &quot;#{loginView.logout}&quot;,
                null, new Class[] {});
MenuItem logout = new MenuItem();
logout.setId(&quot;menuitemlogout&quot;);
logout.setValue(&quot;Sair&quot;);
logout.setActionExpression(logoutAction);
submenuUser.getChildren().add(logout);
</code></pre><p>Pra resolver esse problema criei um PhaseListener que retira os itens de menu que usam link dessa fase de restauração desnecessária, deixando apenas os que usam action expression.</p>
<pre><code>public class RestoreDynamicActionsObserver implements PhaseListener{

    public static final String DYNAMIC_ACTIONS_RENDERKIT = &quot;HTML_BASIC&quot;;

    @Override
    public PhaseId getPhaseId() {
        return PhaseId.RESTORE_VIEW;
    }

    @Override
    public void beforePhase(PhaseEvent event) {

        ResponseStateManager rsm = RenderKitUtils.getResponseStateManager(event.getFacesContext(), DYNAMIC_ACTIONS_RENDERKIT);

        HttpServletRequest httpRequest = WebUtils.getRequest();

        Object[] rawState = (Object[]) rsm.getState(event.getFacesContext(), httpRequest.getRequestURI().replaceFirst(httpRequest.getContextPath(), &quot;&quot;).split(&quot;\\?&quot;)[0]);
        if (rawState == null) {
            return;
        }

        Map&lt;String, Object&gt; state = (Map&lt;String,Object&gt;) rawState[1];

        if(state == null){
            return;
        }

        List&lt;Object&gt; savedActions = (List&lt;Object&gt;) state.get(RIConstants.DYNAMIC_ACTIONS);

        if(savedActions == null){
            return;
        }

        for (Iterator&lt;Object&gt; iterator = savedActions.iterator(); iterator.hasNext();) {
            Object object = iterator.next();
            ComponentStruct action = new ComponentStruct();
            action.restoreState(event.getFacesContext(), object); 

            //Esses são os únicos itens que usam Action Expression, e portanto, não devem ser mexidos
            if(ComponentStruct.ADD.equals(action.action) &amp;&amp; 
                (action.clientId.equals(&quot;menuitemlogout&quot;) || action.clientId.equals(&quot;submenuuseractions&quot;))){
                continue;
            }

            //Os demais itens usam link, e por isso, são retirados dessa coleção
            if (action.clientId.startsWith(&quot;menuitem&quot;) 
                || action.clientId.startsWith(&quot;submenu&quot;)) {                
                iterator.remove();
            }            
        }

    }

    @Override
    public void afterPhase(PhaseEvent event) {
        //
    }
}
</code></pre><p>Com o PhaseListener acima, eu deixo apenas os itens de menu que usam Action Expression na coleção de ações dinâmicas a restaurar. No meu caso, tenho um menu com centenas de itens, dos quais, apenas 2 ou 3 usam action expression e com isso o tempo gasto na restauração das ações dinâmicas caiu bruscamente com  esse ajuste, ficando imperceptível(como deve ser). Isso acontece porque o PhaseListener executa antes da restauração deixando apenas o que realmente é necessário. Ah, outra coisa, as mensagens “Unable to find component…” também devem sumir do seu log. É isso.</p>

	<blockquote>
<p><em>Eu sou o caminho, e a verdade e a vida; ninguém vem ao Pai, senão por mim.</em><br><strong><em>Jesus Cristo</em></strong></p>
</blockquote>

        
            
        
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGS</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Dynamic-Menu/">Dynamic Menu</a> <a class="tag tag--primary tag--small t-link" href="/tags/JSF/">JSF</a> <a class="tag tag--primary tag--small t-link" href="/tags/Menu-Dinamico/">Menu Dinâmico</a> <a class="tag tag--primary tag--small t-link" href="/tags/MenuBar/">MenuBar</a> <a class="tag tag--primary tag--small t-link" href="/tags/PrimeFaces/">PrimeFaces</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/en/2013/01/24/primefaces-dynamic-menu-and-the-harmless-menssage-unable-to-find-component-dot-dot-dot/"  data-tooltip="PrimeFaces: Dynamic Menu and harmless message Unable to find component ...">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">ANTERIOR</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/pt-br/2012/11/02/configurando-o-flushmode-no-seam-persistence/" data-tooltip="Seam Persistence: Configurando o FlushMode">
                
                    <span class="hide-xs hide-sm text-small icon-mr">PRÓXIMO</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://marlonpatrick.info/pt-br/2013/01/24/primefaces-menu-dinamico-e-a-inofensiva-mensagem-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://marlonpatrick.info/pt-br/2013/01/24/primefaces-menu-dinamico-e-a-inofensiva-mensagem-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://marlonpatrick.info/pt-br/2013/01/24/primefaces-menu-dinamico-e-a-inofensiva-mensagem-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
    </ul>
</div>


        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Marlon Patrick. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/en/2013/01/24/primefaces-dynamic-menu-and-the-harmless-menssage-unable-to-find-component-dot-dot-dot/"  data-tooltip="PrimeFaces: Dynamic Menu and harmless message Unable to find component ...">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">ANTERIOR</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/pt-br/2012/11/02/configurando-o-flushmode-no-seam-persistence/" data-tooltip="Seam Persistence: Configurando o FlushMode">
                
                    <span class="hide-xs hide-sm text-small icon-mr">PRÓXIMO</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://marlonpatrick.info/pt-br/2013/01/24/primefaces-menu-dinamico-e-a-inofensiva-mensagem-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://marlonpatrick.info/pt-br/2013/01/24/primefaces-menu-dinamico-e-a-inofensiva-mensagem-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://marlonpatrick.info/pt-br/2013/01/24/primefaces-menu-dinamico-e-a-inofensiva-mensagem-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
    </ul>
</div>


                </div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Marlon Patrick</h4>
        
            <h5 id="about-card-bio"><p>Aficionado por programação (e futebol), Flamenguista, Marido, Cristão</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Desenvolvedor de Software</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Pernambuco - Brasil
            </h5>
        
    </div>
</div>

        <div id="cover" style="background-image:url('/assets/images/cover.png');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = 'marlonpatrickdicasdeumprogramador';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>


    <script type="text/javascript">
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
                (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
            e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','PfLcPuxspuRJ_JEy-A8a','2.0.0');
    </script>


</html>
