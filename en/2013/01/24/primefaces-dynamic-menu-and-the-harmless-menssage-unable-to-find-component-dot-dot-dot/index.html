<!DOCTYPE html>
<html lang="en,pt-br,default">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Marlon Patrick">
    <title>PrimeFaces: Dynamic Menu and harmless message Unable to find component ... - Marlon Patrick</title>
    <meta name="author" content="Marlon Patrick">
    <meta name="description" content="Marlon Patrick">
    <link rel="icon" href="/assets/images/null">
    
        <link rel="alternative" type="application/atom+xml" title="RSS" href="atom.xml">
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css" type="text/css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-29896969-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <header id="header" data-behavior="1">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="http://marlonpatrick.info">Marlon Patrick</a>
    </h1>
    
</header>
            <nav id="sidebar" data-behavior="1">
    
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/">
            
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/all-categories">
            
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/all-tags">
            
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/all-archives">
            
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archive</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link st-search-show-outputs" href="/#search">
            
                    <i class="sidebar-button-icon fa fa-lg fa-search"></i>
                    <span class="sidebar-button-desc">Search</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/#about">
            
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://github.com/marlonpatrick10" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="http://stackoverflow.com/users/1842759/marlon-patrick" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-stack-overflow"></i>
                    <span class="sidebar-button-desc">Stack Overflow</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="https://br.linkedin.com/in/marlonpatrick" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                    <span class="sidebar-button-desc">Linked In</span>
                </a>
        </li>
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="http://www.shelfari.com/o1515626551/shelf" target="_blank">
            
                    <i class="sidebar-button-icon fa fa-lg fa-book"></i>
                    <span class="sidebar-button-desc">Shelfari</span>
                </a>
        </li>
        
    </ul>
    
    <ul class="sidebar-buttons">
        
        <li class="sidebar-button">
            
                <a  class="sidebar-button-link " href="/atom.xml">
            
                    <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
                    <span class="sidebar-button-desc">RSS</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            <div id="main" data-behavior="1">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
        <div class="post-header main-content-wrap">
    
        <h1 class="post-title" itemprop="headline">PrimeFaces: Dynamic Menu and harmless message Unable to find component ...</h1>
    
    <div class="post-meta">
    <time  itemprop="datePublished" content="Thu Jan 24 2013 12:00:00 GMT-0300">
        Jan 24, 2013
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/JSF/">JSF</a>, <a class="category-link" href="/categories/JSF/PrimeFaces/">PrimeFaces</a>


    
</div>

</div>
    
    <div class="post-content markdown main-content-wrap" itemprop="articleBody">
        <p>I am particularly hardcore fan of PrimeFaces and one of the components I like most is to generate dynamic menus. Virtually all applications have the concept of access profile which ends up making the MenuBar component extremely useful for this type of requirement. Basically, the system will only render the menus which point to screens that the user can access.</p>
<a id="more"></a>
<p>Well, I’m using that component precisely in the above scenario with the 3.4.1 version of PrimeFaces and the implementation of JSF reference (Mojarra) in the version 2.1.7. With this combination (PrimeFaces/Mojarra) n the versions described above (believe in others as well) realized in the log my application every time performing an ajax call for each menu item generated with the dynamic MenuBar, there was a message something like this:<strong>Unable to find component with clientId ‘menuitem200’, the need to remove it</strong>.</p>
<p>Up to a certain moment nothing affected me such a message, and is probably so for 99% of cases. Now, if you like me, it fell to the remaining 1%, this message can cause a serious performance problem in ajax calls. This performance problem will only happen if you have a very large page, with many components generated as was my case.</p>
<p>Every time I made a ajax call that page the procedure performed by PrimeFaces that generated the message “Unable to find component …” came to take about 1 minute and 30 seconds to finish, which is totally impractical. It’s not that the code runs on the call was super heavy, these more than 1 minute refer only method execution that generated the messages as shown in the log below:</p>
<pre><code>02:40:00,876 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;submenu1&apos;, no need to remove it.
02:40:01,298 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;submenu2&apos;, no need to remove it.
02:40:01,656 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;menuitem45&apos;, no need to remove it.
02:40:02,014 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;menuitem4&apos;, no need to remove it.
02:40:02,361 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;submenu20&apos;, no need to remove it.

...many others messages here...

02:40:44,240 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;menuitemespacobefore&apos;, no need to remove it.
02:40:44,917 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;submenuuseractions&apos;, no need to remove it.
02:40:45,249 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;menuitemchangepassword&apos;, no need to remove it.
02:40:45,574 INFO  [stdout] (http--0.0.0.0-8080-4) Unable to find component with clientId &apos;menuitemlogout&apos;, no need to remove it.
</code></pre><p>In the above example, the total time was 46 seconds. Basically what happens is that the JSF Restore View phase runs the method that restores the state of the dynamic menus, where for each menu item is done a search on the entire tree of JSF components and due to page be great takes a considerable time. The worst is that as the message itself says, “the need to remove it,” is not necessary to remove this component of the JSF tree because in fact it has already been removed.</p>
<p>In my case, what I realized is that when the dynamic menu item uses a link is not necessary that the removal PrimeFaces tries, as when the menu item uses an Action Expression, then yes, this procedure is necessary.</p>
<pre><code>// It is not necessary to try to remove this MenuItem therefore it uses a link
MenuItem changePassword = new MenuItem();
changePassword.setId(&quot;menuitemchangepassword&quot;);
changePassword.setValue(&quot;Change Password&quot;);
changePassword.setUrl(&quot;/user/changePassword.xhtml?faces-redirect=true&quot;);
submenuUser.getChildren().add(changePassword);

//In fact it is necessary to remove the item menu to add the new object in the Restore View phase, because it uses a Action Expression
MethodExpression logoutAction = factory.createMethodExpression(context.getELContext(), &quot;#{loginView.logout}&quot;,
                null, new Class[] {});
MenuItem logout = new MenuItem();
logout.setId(&quot;menuitemlogout&quot;);
logout.setValue(&quot;Logout&quot;);
logout.setActionExpression(logoutAction);
submenuUser.getChildren().add(logout);
</code></pre><p>To solve this problem I created a PhaseListener that removes the menu items that use this link unnecessary restoration phase, leaving only those who use action expression.</p>
<pre><code>public class RestoreDynamicActionsObserver implements PhaseListener{

    public static final String DYNAMIC_ACTIONS_RENDERKIT = &quot;HTML_BASIC&quot;;

    @Override
    public PhaseId getPhaseId() {
        return PhaseId.RESTORE_VIEW;
    }

    @Override
    public void beforePhase(PhaseEvent event) {

        ResponseStateManager rsm = RenderKitUtils.getResponseStateManager(event.getFacesContext(), DYNAMIC_ACTIONS_RENDERKIT);

        HttpServletRequest httpRequest = WebUtils.getRequest();

        Object[] rawState = (Object[]) rsm.getState(event.getFacesContext(), httpRequest.getRequestURI().replaceFirst(httpRequest.getContextPath(), &quot;&quot;).split(&quot;\\?&quot;)[0]);
        if (rawState == null) {
            return;
        }

        Map&lt;String, Object&gt; state = (Map&lt;String,Object&gt;) rawState[1];

        if(state == null){
            return;
        }

        List&lt;Object&gt; savedActions = (List&lt;Object&gt;) state.get(RIConstants.DYNAMIC_ACTIONS);

        if(savedActions == null){
            return;
        }

        for (Iterator&lt;Object&gt; iterator = savedActions.iterator(); iterator.hasNext();) {
            Object object = iterator.next();
            ComponentStruct action = new ComponentStruct();
            action.restoreState(event.getFacesContext(), object); 

            //These are the only items that use Action Expression, and therefore should not be scrambled
            if(ComponentStruct.ADD.equals(action.action) &amp;&amp; 
                (action.clientId.equals(&quot;menuitemlogout&quot;) || action.clientId.equals(&quot;submenuuseractions&quot;))){
                continue;
            }

            //Other items use link, and so are removed from this collection
            if (action.clientId.startsWith(&quot;menuitem&quot;) 
                || action.clientId.startsWith(&quot;submenu&quot;)) {                
                iterator.remove();
            }            
        }

    }

    @Override
    public void afterPhase(PhaseEvent event) {
        //
    }
}
</code></pre><p>With PhaseListener up, I let only the menu items that use Action Expression in the collection of dynamic actions to restore. In my case, I have a menu with hundreds of items, of which only 2 or 3 using action expression and thus the time spent on the restoration of dynamic shares fell sharply with that adjustment, getting unnoticeable (as it should be). This is because the PhaseListener runs before restoring leaving only what is truly necessary. Oh, another thing, the message “Unable to find component …” should also disappear from your log.</p>

	<blockquote>
<p><em>I am the way, the truth and the life. No one comes to the Father except through me.</em><br><strong><em>Jesus Christ</em></strong></p>
</blockquote>

        
            
        
    </div>
    <div class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGED IN</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/Dynamic-Menu/">Dynamic Menu</a> <a class="tag tag--primary tag--small t-link" href="/tags/JSF/">JSF</a> <a class="tag tag--primary tag--small t-link" href="/tags/MenuBar/">MenuBar</a> <a class="tag tag--primary tag--small t-link" href="/tags/Mojarra/">Mojarra</a> <a class="tag tag--primary tag--small t-link" href="/tags/PrimeFaces/">PrimeFaces</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/pt-br/2013/01/24/primefaces-menu-dinamico-e-o-erro-cannot-remove-the-same-component-twice/"  data-tooltip="PrimeFaces: Menu Dinâmico e o erro Cannot remove the same component twice">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">ANTERIOR</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/pt-br/2013/01/24/primefaces-menu-dinamico-e-a-inofensiva-mensagem-unable-to-find-component-dot-dot-dot/" data-tooltip="PrimeFaces:Menu dinâmico e a inofensiva mensagem Unable to find component...">
                
                    <span class="hide-xs hide-sm text-small icon-mr">PRÓXIMO</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://marlonpatrick.info/en/2013/01/24/primefaces-dynamic-menu-and-the-harmless-menssage-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://marlonpatrick.info/en/2013/01/24/primefaces-dynamic-menu-and-the-harmless-menssage-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://marlonpatrick.info/en/2013/01/24/primefaces-dynamic-menu-and-the-harmless-menssage-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
    </ul>
</div>


        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Marlon Patrick. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="1">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/pt-br/2013/01/24/primefaces-menu-dinamico-e-o-erro-cannot-remove-the-same-component-twice/"  data-tooltip="PrimeFaces: Menu Dinâmico e o erro Cannot remove the same component twice">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">ANTERIOR</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/pt-br/2013/01/24/primefaces-menu-dinamico-e-a-inofensiva-mensagem-unable-to-find-component-dot-dot-dot/" data-tooltip="PrimeFaces:Menu dinâmico e a inofensiva mensagem Unable to find component...">
                
                    <span class="hide-xs hide-sm text-small icon-mr">PRÓXIMO</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://marlonpatrick.info/en/2013/01/24/primefaces-dynamic-menu-and-the-harmless-menssage-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://marlonpatrick.info/en/2013/01/24/primefaces-dynamic-menu-and-the-harmless-menssage-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://marlonpatrick.info/en/2013/01/24/primefaces-dynamic-menu-and-the-harmless-menssage-unable-to-find-component-dot-dot-dot/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
    </ul>
</div>


                </div>
            
        </div>
        <div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Marlon Patrick</h4>
        
            <h5 id="about-card-bio"><p>Passionate about programming (and soccer), CR Flamengo fan, Husband, Christian</p>
</h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Software Developer</p>

            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Pernambuco - Brazil
            </h5>
        
    </div>
</div>

        <div id="cover" style="background-image:url('/assets/images/cover.png');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = 'marlonpatrickdicasdeumprogramador';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>


    <script type="text/javascript">
        (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
                (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
            e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
        })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');

        _st('install','PfLcPuxspuRJ_JEy-A8a','2.0.0');
    </script>


</html>
